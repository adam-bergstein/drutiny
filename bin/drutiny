#!/usr/bin/env php
<?php

use Drutiny\Kernel;
use Drutiny\Console\Application;

if (!in_array(PHP_SAPI, ['cli', 'phpdbg', 'embed'], true)) {
    echo 'Warning: The console should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;
}

set_time_limit(0);

require 'vendor/autoload.php';

const DRUTINY_LIB = '.';

$version_filename = dirname(__DIR__) . '/VERSION';
if (file_exists($version_filename)) {
  $version = file_get_contents($version_filename);
}
elseif ($git_bin = exec('which git')) {
  $version = exec(sprintf('%s -C %s branch', $git_bin, dirname(__DIR__))) . '-dev';
}
else {
  $version = 'dev';
}

$kernel = new Kernel('production');

$application = new Application($kernel, $version);
$application->run();
